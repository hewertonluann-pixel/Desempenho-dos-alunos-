
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciar Chamadas - Orquestra Filhos de Asafe</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap">
  <style>
    :root {
      --bg: #020617;
      --card: #0b1220;
      --card-alt: #0f172a;
      --border: rgba(56, 189, 248, 0.25);
      --ink: #e2e8f0;
      --muted: #94a3b8;
      --azul: #0ea5e9;
      --azul-escuro: #1e293b;
      --azul-suave: rgba(56, 189, 248, 0.2);
      --verde: #22c55e;
      --vermelho: #ef4444;
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', system-ui, sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #0f172a 0%, #020617 45%, #000 100%);
      color: var(--ink);
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: var(--azul);
      margin-bottom: 16px;
      font-size: 1.8rem;
      text-shadow: 0 0 15px rgba(14, 165, 233, 0.3);
    }

    .voltar {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      background: var(--azul-escuro);
      color: var(--azul);
      padding: 10px 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .voltar:hover {
      transform: translateX(-5px);
      background: var(--azul-suave);
      border-color: var(--azul);
    }

    .info {
      text-align: center;
      font-size: 0.95rem;
      color: var(--muted);
      margin-bottom: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .lista {
      max-width: 850px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .evento {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .evento::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--azul);
      opacity: 0.6;
    }

    .evento:hover {
      transform: translateY(-5px);
      border-color: var(--azul);
      box-shadow: 0 15px 35px rgba(14, 165, 233, 0.15);
    }

    .evento h3 {
      margin: 0;
      font-size: 1.2rem;
      color: var(--azul);
    }

    .evento p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .acoes {
      margin-top: 10px;
      display: flex;
      gap: 12px;
    }

    .acoes button {
      flex: 1;
      padding: 10px 15px;
      border-radius: 10px;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-abrir {
      background: var(--azul);
      color: white;
    }

    .btn-abrir:hover {
      background: #0284c7;
      transform: scale(1.02);
    }

    .btn-excluir {
      background: rgba(239, 68, 68, 0.1);
      color: var(--vermelho);
      border: 1px solid var(--vermelho) !important;
    }

    .btn-excluir:hover {
      background: var(--vermelho);
      color: white;
      transform: scale(1.02);
    }

    .vazio {
      grid-column: 1 / -1;
      text-align: center;
      padding: 50px;
      background: var(--card);
      border-radius: 16px;
      border: 1px dashed var(--border);
      color: var(--muted);
      font-style: italic;
    }

    @media (max-width: 600px) {
      .lista {
        grid-template-columns: 1fr;
      }
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <a href="professor.html" class="voltar">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
    Voltar ao Painel
  </a>
  
  <h1>üéµ Gerenciar Chamadas</h1>
  <div class="info">Visualize e gerencie o hist√≥rico de presen√ßas da orquestra.</div>

  <div class="lista" id="listaEventos">
    <!-- Injetado via JS -->
  </div>
  
  <div id="msgVazio" style="display:none;" class="vazio">
    Nenhuma chamada registrada at√© o momento.
  </div>

  <script type="module">
    import { db } from "./firebase-config.js";
    import {
      collection,
      getDocs,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const lista = document.getElementById("listaEventos");
    const msgVazio = document.getElementById("msgVazio");

    function formatarData(iso) {
      if (!iso) return "--/--/----";
      const [ano, mes, dia] = iso.split("-");
      return `${dia}/${mes}/${ano}`;
    }

    async function carregarEventos() {
      lista.innerHTML = "";
      msgVazio.style.display = "none";

      try {
        const snap = await getDocs(collection(db, "eventos"));
        const eventos = [];
        snap.forEach(d => {
          const dados = d.data();
          eventos.push({
            id: d.id,
            data: dados.data || "",
            observacoes: dados.observacoes || ""
          });
        });

        eventos.sort((a, b) => new Date(b.data || "1970-01-01") - new Date(a.data || "1970-01-01"));

        if (!eventos.length) {
          msgVazio.style.display = "block";
          return;
        }

        lista.innerHTML = eventos.map(e => {
          const titulo = e.data ? `Chamada - ${formatarData(e.data)}` : "Chamada sem data";
          const obs = e.observacoes ? e.observacoes : "";
          return `
            <div class="evento">
              <h3>${titulo}</h3>
              ${obs ? `<p><strong>Obs.:</strong> ${obs}</p>` : `<p style="font-style: italic; opacity: 0.5;">Sem observa√ß√µes registradas.</p>`}
              <div class="acoes">
                <button class="btn-abrir" onclick="abrirEvento('${e.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                  Abrir chamada
                </button>
                <button class="btn-excluir" onclick="excluirEvento('${e.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                  Excluir
                </button>
              </div>
            </div>
          `;
        }).join("");
      } catch (error) {
        console.error("Erro ao carregar eventos:", error);
        lista.innerHTML = `<div class="vazio">Erro ao carregar chamadas. Verifique sua conex√£o.</div>`;
      }
    }

    window.abrirEvento = function(id) {
      window.location.href = `ensaio.html?id=${id}`;
    };

    window.excluirEvento = async function(id) {
      if (!confirm("Deseja realmente excluir esta chamada?")) return;
      try {
        await deleteDoc(doc(db, "eventos", id));
        alert("Chamada exclu√≠da com sucesso!");
        carregarEventos();
      } catch (error) {
        alert("Erro ao excluir chamada.");
      }
    };

    carregarEventos();
  </script>
</body>
</html>
